/*2013-08-01-hongru*/!function(a){var b=new a.Class(function(b){var c={pos:null,points:null,invMass:null,angularVel:0,angle:0,vel:[0,0]};a.mix(this,a.mix(c,b||{})),this.pos="number"==typeof this.x&&"number"==typeof this.y?[this.x,this.y]:this.pos,this.matrix=[0,0,0,0,0,0],this.matrixNextFrame=[0,0,0,0,0,0],this.motionBounds=[0,0,0,0,0,0],this.normals=[],this.vCount=this.points.length;for(var d=0;d<this.vCount;d++){var e=this.points[d],f=this.points[(d+1)%this.vCount],g=f[0]-e[0],h=f[1]-e[1],i=Math.sqrt(g*g+h*h);this.normals[d]=[-h/i,g/i]}this.worldSpaceNormals=[],this.worldSpacePoints=[];for(var d=0;d<this.vCount;d++)this.worldSpaceNormals[d]=[0,0],this.worldSpacePoints[d]=[0,0];null==this.invMass&&(this.invMass=this.area()),this.invI=this.invMass>0?1/(1/this.invMass*this.area()/6):0,this.c1=[0,0],this.c0=[0,0]}).methods({featurePairJudgement:function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=0;q<this.vCount;q++){f=this.worldSpaceNormals[q],i=-f[0],j=-f[1],g=[i*a.matrix[0]+j*a.matrix[1],i*a.matrix[2]+j*a.matrix[3]],d=-1,e=-1e6;for(var r=0;r<a.vCount;r++)k=a.points[r],h=g[0]*k[0]+g[1]*k[1],h>e&&(e=h,d=r);c=a.worldSpacePoints[d],l=this.worldSpacePoints[q],m=[c[0]-l[0],c[1]-l[1]],l=this.worldSpacePoints[(q+1)%this.vCount],n=[c[0]-l[0],c[1]-l[1]],o=m[0]*f[0]+m[1]*f[1],i=c[0]-this.pos[0],i=c[1]-this.pos[1],p=i*i+j*j,o>0?(this.projectPointOntoEdge([0,0],m,n,0),o=this.c0[0]*this.c0[0]+this.c0[1]*this.c0[1],o<this.world.mostSeparated[0]?this.world.mostSeparated=[o,d,q,b,p]:o==this.world.mostSeparated[0]&&b==this.world.mostSeparated[3]&&p<this.world.mostSeparated[4]&&(this.world.mostSeparated=[o,d,q,b,p])):o>this.world.mostPenetrating[0]?this.world.mostPenetrating=[o,d,q,b,p]:o==this.world.mostPenetrating[0]&&b==this.world.mostPenetrating[3]&&p<this.world.mostPenetrating[4]&&(this.world.mostPenetrating=[o,d,q,b,p])}},projectPointOntoEdge:function(a,b,c,d){var e=[a[0]-b[0],a[1]-b[1]],f=[c[0]-b[0],c[1]-b[1]],g=(f[0]*e[0]+f[1]*e[1])/(f[0]*f[0]+f[1]*f[1]);g>1&&(g=1),0>g&&(g=0),d?this.c1=[b[0]+f[0]*g,b[1]+f[1]*g]:this.c0=[b[0]+f[0]*g,b[1]+f[1]*g]},area:function(){for(var a=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])},b=0,c=[0,0],d=0;d<this.vCount-1;d++)b+=a(c,this.points[d],this.points[d+1]);return b+=a(c,this.points[this.vCount-1],this.points[0]),Math.abs(b/2)}});a.Polygon=b}(Poco);